<!DOCTYPE html>
<html lang="pl-PL">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etap 4</title>
    <link rel="stylesheet" href="assets/poster/style-poster.css">
</head>
<body>
    <div style="display: flex;" id="info" class="result-contaier">
        <h2>Ułóż plakat z rozsypanki</h2>
        <span class="att">UWAGA!<br>Etap rozpocznie sie po klikniecu przycisku</span>
        <div id="play" class="button-container"><a href="#"><span>Rozpocznij</span></a></div>
    </div>
    <div id="timer" class="timer">03:30</div>
    <div id="result" class="result-contaier">
        <h2>Wygrałeś/aś</h2>
        <div class="button-container"><a href="asteroids.html"><span>Idź dalej</span></a></div>
    </div>
    <div id="result2" class="result-contaier">
        <h2>Przegrałeś/aś</h2>
        <div class="button-container"><a href="asteroids.html"><span>Idź dalej</span></a></div>
    </div>
    <div class="scale">
        <section>
            <div id="plansza"></div>
        </section>
        <section>
            <div id="elelemnty">
                <img src="assets/poster/img/1.png" alt="Image 1" draggable="true">
                <img src="assets/poster/img/2.png" alt="Image 2" draggable="true">
                <img src="assets/poster/img/3.png" alt="Image 3" draggable="true">
                <img src="assets/poster/img/4.png" alt="Image 4" draggable="true">
                <img src="assets/poster/img/5.png" alt="Image 5" draggable="true">
                <img src="assets/poster/img/6.png" alt="Image 6" draggable="true">
                <img src="assets/poster/img/7.png" alt="Image 7" draggable="true">
                <img src="assets/poster/img/8.png" alt="Image 8" draggable="true">
                <img src="assets/poster/img/9.png" alt="Image 9" draggable="true">
                <img src="assets/poster/img/10.png" alt="Image 10" draggable="true">
                <img src="assets/poster/img/11.png" alt="Image 11" draggable="true">
            </div>
        </section>
    </div>

<script>
  function getCookie(name) {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.startsWith(name + '=')) {
            return decodeURIComponent(cookie.split('=')[1]);
        }
    }
    return null;
}

function setCookie(name, value, days) {
    const expires = new Date();
    expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
    const expiresString = `expires=${expires.toUTCString()}`;

    // Ustawienie ciasteczka z atrybutem SameSite=None oraz Secure
    document.cookie = `${name}=${encodeURIComponent(value)}; ${expiresString}; path=/; SameSite=None; Secure`;
}


let gameWon = parseInt(getCookie('gameWon'), 10) || 0; // Wczytaj licznik wygranych lub ustaw na 0
function incrementWinCookie() {
    gameWon++;
    setCookie('gameWon', gameWon, 365); // Zapisz nową wartość
    console.log(`Liczba wygranych została zwiększona do: ${gameWon}`);
}


    const win = document.getElementById('result');
    let gameEnded = false;
    // Pobieranie wszystkich obrazków w elelemnty
    const images = document.querySelectorAll('#elelemnty img');
const plansza = document.getElementById('plansza');

function startTimer() {
      // Ustawienie początkowego czasu (2 minuty = 120 sekund)
      let remainingTime = 210; // 2 minuty (120 sekund)

      // Zaktualizuj czas w elemencie #timer
      const timerElement = document.getElementById("timer");

      // Co sekundę aktualizuj timer
      const interval = setInterval(function() {
        // Oblicz minuty i sekundy
        const minutes = Math.floor(remainingTime / 60);
        const seconds = remainingTime % 60;

        // Formatowanie czasu w formacie mm:ss
        timerElement.innerText = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

        remainingTime--;

        // Jeśli czas się skończy, zmień display elementu #result na flex i zatrzymaj timer
        if (remainingTime < 0) {
          clearInterval(interval);
          const resultElement = document.getElementById("result2");
          if (resultElement) {
            gameEnded = true; 
            resultElement.style.display = "flex";
          }
        }
      }, 1000); // Co 1000 ms (1 sekunda)
    }

    // Wywołaj funkcję, aby uruchomić timer


// Funkcja do inicjalizacji przeciągania i dotyku
images.forEach(img => {
    img.addEventListener('dragstart', dragStart);
    img.addEventListener('touchstart', touchStart);
    img.addEventListener('touchmove', touchMove);
    img.addEventListener('touchend', touchEnd);
});

let draggedImg = null;
let touchOffsetX = 0;
let touchOffsetY = 0;

function dragStart(e) {
    if (gameEnded) return;
    draggedImg = e.target;
    setTimeout(() => {
        draggedImg.style.opacity = '0.9';
    }, 0);
}

// Obsługa przeciągania myszką po planszy
plansza.addEventListener('dragover', dragOver);
plansza.addEventListener('drop', drop);

function dragOver(e) {
    if (gameEnded) return;
    e.preventDefault(); // Zezwolenie na upuszczenie
}

function drop(e) {
    if (gameEnded) return;
    e.preventDefault();
    const rect = plansza.getBoundingClientRect();
    const x = e.clientX - rect.left - draggedImg.width / 2;
    const y = e.clientY - rect.top - draggedImg.height / 2;

    setPosition(draggedImg, x, y);
    draggedImg.style.opacity = '1'; // Przywrócenie pełnej widoczności
    plansza.appendChild(draggedImg); // Dodanie obrazka do planszy
}

// Funkcja pomocnicza do ustawiania pozycji elementu
function setPosition(img, x, y) {
    img.style.position = 'absolute';
    img.style.left = `${x}px`;
    img.style.top = `${y}px`;
}

// Obsługa dotyku
function touchStart(e) {
    if (gameEnded) return;
    const touch = e.touches[0];
    draggedImg = e.target;

    // Obliczenie przesunięcia dotyku względem obrazka
    const rect = draggedImg.getBoundingClientRect();
    touchOffsetX = touch.clientX - rect.left;
    touchOffsetY = touch.clientY - rect.top;

    draggedImg.style.opacity = '0.9';
}

function touchMove(e) {
    if (gameEnded) return;
    e.preventDefault(); // Zapobiega przewijaniu strony podczas przesuwania
    if (!draggedImg) return;

    const touch = e.touches[0];
    const rect = plansza.getBoundingClientRect();

    const x = touch.clientX - rect.left - touchOffsetX;
    const y = touch.clientY - rect.top - touchOffsetY;

    setPosition(draggedImg, x, y);
}

function touchEnd() {
    if (gameEnded) return;
    if (draggedImg) {
        draggedImg.style.opacity = '1'; // Przywrócenie pełnej widoczności
        plansza.appendChild(draggedImg); // Dodanie obrazka do planszy
        draggedImg = null;
    }
}

// Funkcja do sprawdzania poprawności ułożenia elementów
// Definicja poprawnych pozycji obrazków
const correctPositions = {
    "1.png": { x: 0, y: 0 },
    "2.png": { x: 111.2, y: 0 },
    "3.png": { x: 111.2, y: 58.4 },
    "4.png": { x: 111.2, y: 105.6 },
    "5.png": { x: 260, y: 105.6 },
    "6.png": { x: 0, y: 150.4 },
    "7.png": { x: 111.2, y: 244.8 },
    "8.png": { x: 0, y: 288.8 },
    "9.png": { x: 85.6, y: 288.8 },
    "10.png": { x: 0, y: 408 },
    "11.png": { x: 0, y: 468 }
    // Dodaj pozostałe elementy i ich poprawne pozycje
};
function checkPositions() {
    if (gameEnded) return;
    let allCorrect = true;
    let anyOnBoard = false;

    const elements = plansza.querySelectorAll('img');
    elements.forEach(img => {
        anyOnBoard = true;
        const rect = img.getBoundingClientRect();
        const planszaRect = plansza.getBoundingClientRect();

        const currentX = rect.left - planszaRect.left;
        const currentY = rect.top - planszaRect.top;

        const imgName = img.src.split('/').pop();
        const correct = correctPositions[imgName];

        if (!correct) {
            allCorrect = false;
            return;
        }

        const tolerance = 50;
        if (
            Math.abs(currentX - correct.x) > tolerance ||
            Math.abs(currentY - correct.y) > tolerance
        ) {
            allCorrect = false;
        }
    });

    if (!anyOnBoard) {
        alert("Żaden element nie znajduje się na planszy.");
        return;
    }

    if (allCorrect) {
        win.style.display = 'flex';
        incrementWinCookie(); // Zwiększ licznik wygranych i zaloguj w konsoli
    } else {
        alert("Niektóre elementy nie są w prawidłowych pozycjach.");
    }
}

// Dodanie przycisku do sprawdzania pozycji
const checkButton = document.createElement('button');
checkButton.textContent = "Sprawdź ułożenie";
checkButton.style.margin = "10px";
checkButton.addEventListener('click', checkPositions);

document.body.appendChild(checkButton);

document.getElementById('play').onclick = function () {
    document.getElementById('info').style.display = 'none';
    document.getElementById('play').style.display = 'none';
    startTimer();
};


</script>

</body>
</html>
