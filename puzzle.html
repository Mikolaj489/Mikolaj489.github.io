<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gra - Przeciąganie</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            text-align: center;
        }

        #plansza {
            width: 400px;
            height: 400px;
            margin: 0 auto;
            display: flex;
            flex-wrap: wrap;
        }

        #plansza img {
            width: 79px;
            height: 79px;
            border: 0.5px solid rgb(90, 90, 90);
        }

        #elementy {
            width: 1040px;
            height: 160px;
            margin: 20px auto;
            display: flex;
            flex-wrap: wrap;
        }

        #elementy img {
            width: 79px;
            height: 79px;
        }
    </style>
</head>
<body>
    <div id="plansza"></div>
    <div id="elementy"></div>
    <script>
        var wiersze = 4;
        var kolumny = 5;

        var obecnyElement;
        var innyElement;

        window.onload = function() {
            // Plansza 4x5
            for (let r = 0; r < wiersze; r++) {
                for (let c = 0; c < kolumny; c++) {
                    let element = document.createElement("img");
                    element.src = "img/blank.jpg";

                    // Obsługa przeciągania dla komputerów
                    element.addEventListener("dragstart", rozpocznijPrzeciaganie);
                    element.addEventListener("dragover", pozwolPrzeciaganie);
                    element.addEventListener("dragenter", wejdzWPrzeciagany);
                    element.addEventListener("drop", upuscElement);
                    element.addEventListener("dragend", zakonczPrzeciaganie);

                    // Obsługa dotyku dla telefonów
                    element.addEventListener("touchstart", rozpocznijDotyk);
                    element.addEventListener("touchmove", przesunElement);
                    element.addEventListener("touchend", zakonczDotyk);

                    document.getElementById("plansza").append(element);
                }
            }

            // Tworzenie elementów do przeciągania
            let elementy = [];
            for (let i = 1; i <= wiersze * kolumny; i++) {
                elementy.push(i.toString());
            }
            elementy = elementy.sort(() => Math.random() - 0.5); // Tasowanie

            for (let i = 0; i < elementy.length; i++) {
                let element = document.createElement("img");
                element.src = "img/" + elementy[i] + ".png";

                // Obsługa przeciągania dla komputerów
                element.addEventListener("dragstart", rozpocznijPrzeciaganie);
                element.addEventListener("dragover", pozwolPrzeciaganie);
                element.addEventListener("dragenter", wejdzWPrzeciagany);
                element.addEventListener("drop", upuscElement);
                element.addEventListener("dragend", zakonczPrzeciaganie);

                // Obsługa dotyku dla telefonów
                element.addEventListener("touchstart", rozpocznijDotyk);
                element.addEventListener("touchmove", przesunElement);
                element.addEventListener("touchend", zakonczDotyk);

                document.getElementById("elementy").append(element);
            }
        };

        // Obsługa przeciągania myszką
        function rozpocznijPrzeciaganie() {
            obecnyElement = this;
        }

        function pozwolPrzeciaganie(e) {
            e.preventDefault();
        }

        function wejdzWPrzeciagany(e) {
            e.preventDefault();
        }

        function upuscElement() {
            innyElement = this;
        }

        function zakonczPrzeciaganie() {
            if (obecnyElement.src.includes("blank")) return;
            let obecnyObraz = obecnyElement.src;
            let innyObraz = innyElement.src;
            obecnyElement.src = innyObraz;
            innyElement.src = obecnyObraz;
        }

        // Obsługa dotyku
        function rozpocznijDotyk(e) {
            e.preventDefault();
            obecnyElement = e.target;
        }

        function przesunElement(e) {
            e.preventDefault();
            let touch = e.touches[0];
            let elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);

            if (elementUnderTouch && elementUnderTouch.tagName === "IMG") {
                innyElement = elementUnderTouch;
            }
        }

        function zakonczDotyk(e) {
            e.preventDefault();
            if (obecnyElement && innyElement) {
                let obecnyObraz = obecnyElement.src;
                let innyObraz = innyElement.src;
                obecnyElement.src = innyObraz;
                innyElement.src = obecnyObraz;
            }
        }
        function rozpocznijPrzeciaganie(e) {
    obecnyElement = this;

    // Tworzenie podglądu obrazu podczas przeciągania
    let podglad = document.createElement("img");
    podglad.src = obecnyElement.src;
    podglad.style.width = "79px";
    podglad.style.height = "79px";
    document.body.appendChild(podglad);

    // Ustawienie niestandardowego podglądu
    e.dataTransfer.setDragImage(podglad, 40, 40);

    // Usuwanie podglądu po rozpoczęciu przeciągania
    setTimeout(() => podglad.remove(), 0);
}

    </script>
</body>
</html>
