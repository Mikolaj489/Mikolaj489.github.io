<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Etap x</title>
    <link rel="stylesheet" href="assets/puzzle/style-puzzle.css">
</head>
<body>
    <section class="plansza-container">
        <div id="plansza"></div>
    </section>
    <section class="elementy-container">
        <div id="elementy"></div>
    </section>
    <script>
        var wiersze = 4;
        var kolumny = 5;

        var obecnyElement;
        var innyElement;

        window.onload = function() {
            // Plansza 4x5
            for (let r = 0; r < wiersze; r++) {
                for (let c = 0; c < kolumny; c++) {
                    let element = document.createElement("img");
                    element.src = "assets/puzzle/img/blank.jpg";

                    // Obsługa przeciągania dla komputerów
                    element.addEventListener("dragstart", rozpocznijPrzeciaganie);
                    element.addEventListener("dragover", pozwolPrzeciaganie);
                    element.addEventListener("dragenter", wejdzWPrzeciagany);
                    element.addEventListener("drop", upuscElement);
                    element.addEventListener("dragend", zakonczPrzeciaganie);

                    // Obsługa dotyku dla telefonów
                    element.addEventListener("touchstart", rozpocznijDotyk);
                    element.addEventListener("touchmove", przesunElement);
                    element.addEventListener("touchend", zakonczDotyk);

                    document.getElementById("plansza").append(element);
                }
            }

            // Tworzenie elementów do przeciągania
            let elementy = [];
            for (let i = 1; i <= wiersze * kolumny; i++) {
                elementy.push(i.toString());
            }
            elementy = elementy.sort(() => Math.random() - 0.5); // Tasowanie

            for (let i = 0; i < elementy.length; i++) {
                let element = document.createElement("img");
                element.src = "assets/puzzle/img/" + elementy[i] + ".png";

                // Obsługa przeciągania dla komputerów
                element.addEventListener("dragstart", rozpocznijPrzeciaganie);
                element.addEventListener("dragover", pozwolPrzeciaganie);
                element.addEventListener("dragenter", wejdzWPrzeciagany);
                element.addEventListener("drop", upuscElement);
                element.addEventListener("dragend", zakonczPrzeciaganie);

                // Obsługa dotyku dla telefonów
                element.addEventListener("touchstart", rozpocznijDotyk);
                element.addEventListener("touchmove", przesunElement);
                element.addEventListener("touchend", zakonczDotyk);

                document.getElementById("elementy").append(element);
            }
        };

        // Obsługa przeciągania myszką
        function rozpocznijPrzeciaganie() {
            obecnyElement = this;
        }

        function pozwolPrzeciaganie(e) {
            e.preventDefault();
        }

        function wejdzWPrzeciagany(e) {
            e.preventDefault();
        }

        function upuscElement() {
            innyElement = this;
        }

        function zakonczPrzeciaganie() {
            if (obecnyElement.src.includes("blank")) return;

            let obecnyObraz = obecnyElement.src;
            let innyObraz = innyElement.src;

            // Zamiana obrazów
            obecnyElement.src = innyObraz;
            innyElement.src = obecnyObraz;

            // Jeśli element został przeciągnięty na planszę, usuń go z elementów
            if (innyElement.parentElement.id === "plansza" && obecnyElement.parentElement.id === "elementy") {
                obecnyElement.remove(); // Usuń przeciągnięty element z sekcji #elementy
            }
        }


        // Obsługa dotyku
        function rozpocznijDotyk(e) {
            e.preventDefault();
            obecnyElement = e.target;
        }

        function przesunElement(e) {
            e.preventDefault();
            let touch = e.touches[0];
            let elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);

            if (elementUnderTouch && elementUnderTouch.tagName === "IMG") {
                innyElement = elementUnderTouch;
            }
        }

        function zakonczDotyk(e) {
            e.preventDefault();

            if (obecnyElement && innyElement) {
                let obecnyObraz = obecnyElement.src;
                let innyObraz = innyElement.src;

                // Zamiana obrazów
                obecnyElement.src = innyObraz;
                innyElement.src = obecnyObraz;

                // Jeśli element został przeciągnięty na planszę, usuń go z elementów
                if (innyElement.parentElement.id === "plansza" && obecnyElement.parentElement.id === "elementy") {
                    obecnyElement.remove(); // Usuń przeciągnięty element z sekcji #elementy
                }
            }
        }

    </script>
</body>
</html>
